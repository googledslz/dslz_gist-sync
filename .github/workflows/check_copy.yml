      - name: Run  check_copy.yml
        run: |
          import os, requests, pathlib, yaml

          token = os.environ["GIST_TOKEN"]
          gist_id = os.environ["GIST_ID"]
          gist_user = os.environ["GIST_USER"]

          # ç¡®ä¿ tmp ç›®å½•å­˜åœ¨
          tmp_dir = pathlib.Path("tmp")
          tmp_dir.mkdir(exist_ok=True)

          cache_file = tmp_dir / "zhu_he_last.txt"
          pc_file = tmp_dir / "pc.yaml"

          # æ„é€  Gist æ–‡ä»¶ URL
          base_url = f"https://gist.githubusercontent.com/{gist_user}/{gist_id}/raw"
          zhu_he_url = f"{base_url}/ZHU_HE"
          fu_xie_a_url = f"{base_url}/fu_xie_A"

          # ä¸‹è½½æ–‡ä»¶
          zhu_he_content = requests.get(zhu_he_url).text
          fu_xie_a_content = requests.get(fu_xie_a_url).text

          # ===========================
          # 1ï¸âƒ£ åˆ¤æ–­ ZHU_HE æ˜¯å¦å˜åŒ–
          # ===========================
          old_content = ""
          if cache_file.exists():
              old_content = cache_file.read_text()

          if zhu_he_content != old_content:
              print("ğŸ”„ ZHU_HE å†…å®¹å˜åŒ–ï¼Œæ›´æ–° Gist å¹¶å†™å…¥ pc.yaml")

              # æ›´æ–° Gistï¼ˆä¿æŒåŸå§‹å†…å®¹ï¼Œä¸ä¿®æ”¹ï¼‰
              update_url = f"https://api.github.com/gists/{gist_id}"
              headers = {"Authorization": f"token {token}"}
              data_payload = {"files": {"ZHU_HE": {"content": zhu_he_content}}}
              res = requests.patch(update_url, headers=headers, json=data_payload)
              print("Update status:", res.status_code, res.text)

              # æ›´æ–°ç¼“å­˜
              cache_file.write_text(zhu_he_content, encoding="utf-8")

              # ===========================
              # 2ï¸âƒ£ å†™å…¥ tmp/pc.yamlï¼ˆå¸¦ proxies é‡å‘½åï¼‰
              # ===========================
              try:
                  data = yaml.safe_load(zhu_he_content)
              except Exception:
                  print("âš ï¸ ZHU_HE å†…å®¹ä¸æ˜¯æœ‰æ•ˆ YAMLï¼Œç›´æ¥åŸæ ·å†™å…¥ pc.yaml")
                  data = {}

              if isinstance(data, dict) and "proxies" in data:
                  proxies = data["proxies"]
                  seen = {}
                  for proxy in proxies:
                      base_name = proxy.get("name", "")
                      if base_name not in seen:
                          seen[base_name] = 1
                      else:
                          count = seen[base_name]
                          new_name = f"{base_name}-{count}"
                          while new_name in seen:
                              count += 1
                              new_name = f"{base_name}-{count}"
                          proxy["name"] = new_name
                          seen[base_name] += 1
                          seen[new_name] = 1
                  data["proxies"] = proxies
                  zhu_he_fixed = yaml.dump(data, allow_unicode=True)
              else:
                  zhu_he_fixed = zhu_he_content

              # åˆå¹¶å†™å…¥
              if pc_file.exists():
                  pc_file.unlink()
              pc_file.write_text(zhu_he_fixed + "\n" + fu_xie_a_content, encoding="utf-8")
              print(f"âœ… å·²å†™å…¥åˆå¹¶å†…å®¹åˆ° {pc_file}")
          else:
              print("âœ… ZHU_HE å†…å®¹æœªå˜åŒ–ï¼Œè·³è¿‡æ›´æ–° Gist å’Œ pc.yaml")

        shell: python
